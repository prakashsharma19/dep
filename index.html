<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PPH Dept.</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background-color: #eef2f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: linear-gradient(90deg,#003366,#0055aa);
      color: #fff;
      padding: 15px 30px;
      font-size: 24px;
      display: flex;
      align-items: center;
    }
    header .logo {
      height: 30px;
      margin-right: 10px;
    }
    .container {
      padding: 30px;
      background-color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 10px;
      width: 100%;
      max-width: none;
      display: flex;
      margin: 0;
      min-height: calc(100vh - 60px);
    }
    .left-section {
      flex: 2.5;
      padding-right: 20px;
    }
    .right-section {
      flex: 1.5;
      border-left: 1px solid #ccc;
      padding-left: 20px;
      background-color: #f9f9f9;
    }
    #dropArea {
      border: 2px dashed #ccc;
      border-radius: 6px;
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
      color: #777;
      background-color: #fafafa;
      cursor: pointer;
    }
    #fileInput {
      display: none;
    }
    #fileList {
      font-size: 14px;
      color: #444;
      margin-bottom: 15px;
    }
    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      background: #f1f1f1;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .file-item button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }
    input[type="file"], input[type="text"], textarea, button {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #003366;
      color: #fff;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    button:hover {
      background-color: #0055aa;
    }
    .btn-icon {
      width: 24px;
      height: 24px;
    }

    .keyword-container {
      margin-bottom: 15px;
    }


    .selected-keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 10px;
    }

    .keyword-tag {
      background: #007bff;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 20px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: transform 0.2s;
    }

    .keyword-tag:hover {
      transform: scale(1.2);
    }

    .keyword-tag button {
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      font-size: 12px;
      padding: 0;
    }

    .rest-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      padding: 5px 8px;
      border-radius: 4px;
      margin-bottom: 5px;
    }

    .rest-item button {
      font-size: 12px;
      padding: 4px 6px;
    }

    .domain-filter {
      margin-bottom: 15px;
    }
    .filter-row {
      display: flex;
      gap: 15px;
      align-items: flex-end;
    }

    .domain-wrapper {
      display: flex;
      align-items: center;
    }

    .domain-wrapper select {
      margin-right: 10px;
      width: 200px;
    }


    #totalEntries {
      font-weight: bold;
      margin-bottom: 15px;
    }

    #addSuggestion {
      margin-left: 5px;
      background: none;
      border: none;
      cursor: pointer;
      color: #007bff;
    }


    .suggestions {
      max-height: calc(100vh - 120px);
      overflow-y: auto;
    }

    .suggestions ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .suggestions li {
      background: #f1f1f1;
      margin-bottom: 5px;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      color: blue;
      display: flex;
      align-items: center;
      gap: 5px;
      flex-wrap: nowrap;
    }

    .suggest-word {
      cursor: pointer;
    }

    .suggestions li span {
      white-space: nowrap;
    }
    .file-item span {
      white-space: normal;
      overflow-wrap: break-word;
      word-break: normal;
    }

    .suggestions li button,
    .file-item button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      margin-left: 5px;
      width: auto;
      margin-bottom: 0;
      display: inline;
    }

    .suggestions li button img,
    .file-item button img {
      width: 24px;
      height: 24px;
    }

    .suggestions li:hover {
      background: #e0e0e0;
    }
  </style>
</head>
<body>
  <header><img src="https://raw.githubusercontent.com/prakashsharma19/hosted-images/main/pphlogo.png" alt="PPH logo" class="logo">PPH Dept.</header>
  <div class="container">
    <div class="left-section">
      <div id="dropArea">Drag &amp; Drop files here or click to browse</div>
      <input type="file" id="fileInput" multiple accept=".txt">
      <div id="fileList"></div>
      <div class="keyword-container">
        <div id="selectedKeywords" class="selected-keywords"></div>
        <input id="keywordInput" type="text" placeholder="Add keyword and press Enter">
        <input type="hidden" id="searchTerm">
      </div>
<div class="filter-row">
      <div class="domain-filter">
        <label for="emailFilter">Email Domain</label>
        <div class="domain-wrapper">
          <select id="emailFilter">
            <option value="">All Domains</option>
            <option value="yahoo.com">Yahoo</option>
            <option value="gmail.com">Gmail</option>
            <option value="hotmail.com">Hotmail</option>
            <option value="live.com">Live</option>
          </select>
        </div>
      </div>
      
</div>
      <div id="totalEntries">Total Entries: <span id="totalCount">0</span></div>
      <button id="processBtn" style="background-color:#28a745;"><img src="https://cdn-icons-png.flaticon.com/512/3079/3079162.png" class="btn-icon" alt="process">Process</button>
      <div id="processOptions" style="display:none; margin-top:10px;">
        <button id="extractBtn" onclick="extractEntries()"><img src="https://cdn-icons-png.flaticon.com/512/6713/6713062.png" class="btn-icon" alt="extract">Extract and Download (<span id="extractCount">0</span>)</button>
        <button id="restBtn" onclick="downloadRest()"><img src="https://cdn-icons-png.flaticon.com/512/9502/9502265.png" class="btn-icon" alt="download">Download Rest (<span id="restCount">0</span>)</button>
      </div>
  <div id="restContainer" style="display:none; margin-top:20px;">
    <h3>Rest Files</h3>
    <button id="restAllBtn" style="margin-top:10px;"><img src="https://cdn-icons-png.flaticon.com/512/9502/9502265.png" class="btn-icon" alt="download">Download All Rest Files</button>
    <button id="restCombinedBtn" style="margin-top:10px;"><img src="https://cdn-icons-png.flaticon.com/512/9502/9502265.png" class="btn-icon" alt="download">Download All Combined</button>
    <div id="restList"></div>
  </div>
    </div>
    <div class="right-section">
      <h3>File based suggestion:</h3>
      <div class="suggestions">
        <ul id="fileSuggestionsList"></ul>
      </div>
      <h3>Keyword Suggestions <button type="button" id="addSuggestion">+</button></h3>
      <div class="suggestions">
        <ul id="suggestionsList"></ul>
      </div>
    </div>
  </div>

  <script>
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const fileListDisplay = document.getElementById('fileList');
    let allFiles = [];

    let defaultSuggestions = ['Mathematics', 'Statistics'];
    let fileSuggestions = {};
    let selectedKeywords = [];

    function getCustomDomains() {
      try {
        return JSON.parse(localStorage.getItem('customDomains') || '[]');
      } catch (e) {
        return [];
      }
    }

    function saveCustomDomains(list) {
      localStorage.setItem('customDomains', JSON.stringify(list));
    }

    function addDomainOption(domain) {
      const select = document.getElementById('emailFilter');
      if (!select) return;
      const opt = document.createElement('option');
      opt.value = domain;
      opt.textContent = domain;
      select.appendChild(opt);
    }


    function getStoredSuggestions() {
      try {
        const raw = localStorage.getItem('keywordSuggestions');
        if (!raw) return {};
        const data = JSON.parse(raw);
        if (Array.isArray(data)) {
          const obj = {};
          data.forEach(k => obj[k] = (obj[k] || 0) + 1);
          localStorage.setItem('keywordSuggestions', JSON.stringify(obj));
          return obj;
        }
        return data;
      } catch (e) {
        return {};
      }
    }

    function updateSuggestionsUI() {
      const list = document.getElementById('suggestionsList');
      if (!list) return;
      const stored = getStoredSuggestions();
      const defaults = defaultSuggestions.map(s => ({ text: s, count: stored[s] || 0 }));
      const rest = Object.keys(stored)
        .filter(k => !defaultSuggestions.includes(k))
        .map(k => ({ text: k, count: stored[k] }))
        .sort((a, b) => b.count - a.count);
      const sorted = [...defaults, ...rest];

      const liMarkup = s => {
        const words = s.text.split(/\s+/).map(w => `<span class="suggest-word" data-word="${w}">${w}</span>`).join(' ');
        return `<li data-text="${s.text}">${words}<button class="all-btn"><img src="https://cdn-icons-png.flaticon.com/512/14540/14540378.png" class="btn-icon" alt="all"></button><button class="del-btn"><img src="https://img.icons8.com/?size=100&id=67884&format=png&color=000000" class="btn-icon" alt="delete"></button></li>`;
      };

      list.innerHTML = sorted.map(liMarkup).join('');

      list.querySelectorAll('li').forEach(li => {
        li.querySelectorAll('.suggest-word').forEach(sw => {
          sw.addEventListener('click', e => {
            e.stopPropagation();
            selectSuggestion(sw.dataset.word);
          });
        });
        const allBtn = li.querySelector('.all-btn');
        if (allBtn) {
          allBtn.addEventListener('click', e => {
            e.stopPropagation();
            selectSuggestion(li.dataset.text);
          });
        }
        const delBtn = li.querySelector('.del-btn');
        if (delBtn) {
          delBtn.addEventListener('click', e => {
            e.stopPropagation();
            deleteSuggestion(li.dataset.text);
          });
        }
      });
    }

    function deleteSuggestion(text) {
      const stored = getStoredSuggestions();
      if (stored[text]) {
        delete stored[text];
        localStorage.setItem('keywordSuggestions', JSON.stringify(stored));
      }
      updateSuggestionsUI();
    }

    function updateFileSuggestionsUI() {
      const list = document.getElementById('fileSuggestionsList');
      if (!list) return;
      const sorted = Object.keys(fileSuggestions)
        .map(k => ({ text: k, count: fileSuggestions[k] }))
        .sort((a, b) => b.count - a.count);

      const liMarkup = s => {
        const words = s.text.split(/\s+/).map(w => `<span class="suggest-word" data-word="${w}">${w}</span>`).join(' ');
        return `<li data-text="${s.text}">${words}<button class="all-btn"><img src="https://cdn-icons-png.flaticon.com/512/14540/14540378.png" class="btn-icon" alt="all"></button><button class="del-btn"><img src="https://img.icons8.com/?size=100&id=67884&format=png&color=000000" class="btn-icon" alt="delete"></button></li>`;
      };

      list.innerHTML = sorted.map(liMarkup).join('');
      list.querySelectorAll('li').forEach(li => {
        li.querySelectorAll('.suggest-word').forEach(sw => {
          sw.addEventListener('click', e => {
            e.stopPropagation();
            selectSuggestion(sw.dataset.word);
          });
        });
        const allBtn = li.querySelector('.all-btn');
        if (allBtn) {
          allBtn.addEventListener('click', e => {
            e.stopPropagation();
            selectSuggestion(li.dataset.text);
          });
        }
        const delBtn = li.querySelector('.del-btn');
        if (delBtn) {
          delBtn.addEventListener('click', e => {
            e.stopPropagation();
            li.remove();
          });
        }
      });
    }

    function generateFileSuggestions() {
      fileSuggestions = {};
      if (!allFiles.length) {
        updateFileSuggestionsUI();
        return;
      }
      let read = 0;
      allFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const text = e.target.result;
          const regex = /Department[^\n]*/gi;
          let m;
          while ((m = regex.exec(text)) !== null) {
            const t = m[0].trim();
            fileSuggestions[t] = (fileSuggestions[t] || 0) + 1;
          }
          read++;
          if (read === allFiles.length) updateFileSuggestionsUI();
        };
        reader.readAsText(file);
      });
    }

  function addKeyword(text) {
      text = text.trim();
      if (!text || selectedKeywords.includes(text)) return;
      selectedKeywords.push(text);
      updateKeywordUI();
      clearRestResults();
      resetProcessButton();
      updateCounts();
    }

    function updateKeywordUI() {
      const container = document.getElementById('selectedKeywords');
      const hidden = document.getElementById('searchTerm');
      if (!container) return;
      container.innerHTML = '';
      selectedKeywords.forEach((k, i) => {
        const span = document.createElement('span');
        span.className = 'keyword-tag';
        const text = document.createElement('span');
        text.textContent = k;
        const btn = document.createElement('button');
        btn.textContent = 'x';
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          removeKeyword(i);
        });
        span.appendChild(text);
        span.appendChild(btn);
        container.appendChild(span);
      });
      if (hidden) hidden.value = selectedKeywords.join(',');
    }

  function removeKeyword(index) {
      selectedKeywords.splice(index, 1);
      updateKeywordUI();
      clearRestResults();
      resetProcessButton();
      updateCounts();
    }

    function selectSuggestion(text) {
      addKeyword(text);
    }

    function matchesDomain(text, domain) {
      if (!domain) return true;
      const regex = /[A-Za-z0-9._%+-]+@([A-Za-z0-9.-]+\.[A-Za-z]{2,})/g;
      let match;
      while ((match = regex.exec(text)) !== null) {
        const d = match[1].toLowerCase();
        if (d.endsWith(domain)) {
          return true;
        }
      }
      return false;
    }

    function saveSuggestion(keyword) {
      if (!keyword) return;
      const stored = getStoredSuggestions();
      stored[keyword] = (stored[keyword] || 0) + 1;
      localStorage.setItem('keywordSuggestions', JSON.stringify(stored));
      updateSuggestionsUI();
    }
    function getKeywords() {
      return selectedKeywords.slice();
    }

    function calculateCounts(cb) {
      const keywords = getKeywords().map(k => k.toLowerCase());
      const domain = document.getElementById('emailFilter').value;
      if (!allFiles.length) { cb({total:0, rest:0}); return; }
      let total = 0;
      let rest = 0;
      let processed = 0;
      allFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const lines = e.target.result.split(/\r?\n/);
          let block = [];
          for (let line of lines) {
            if (line.trim() === '') {
              const text = block.join('\n');
              const kwMatch = keywords.length ? keywords.some(k => text.toLowerCase().includes(k)) : true;
              const dMatch = matchesDomain(text, domain);
              if (kwMatch && dMatch) total++; else rest++;
              block = [];
            } else {
              block.push(line);
            }
          }
          if (block.length) {
            const text = block.join('\n');
            const kwMatch = keywords.length ? keywords.some(k => text.toLowerCase().includes(k)) : true;
            const dMatch = matchesDomain(text, domain);
            if (kwMatch && dMatch) total++; else rest++;
          }
          processed++;
          if (processed === allFiles.length) cb({total, rest});
        };
        reader.readAsText(file);
      });
    }

    function updateCounts() {
      calculateCounts(({total, rest}) => {
        const totalSpan = document.getElementById('totalCount');
        const extractSpan = document.getElementById('extractCount');
        const restSpan = document.getElementById('restCount');
        if (totalSpan) totalSpan.textContent = total;
        if (extractSpan) extractSpan.textContent = total;
        if (restSpan) restSpan.textContent = rest;
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateSuggestionsUI();
      generateFileSuggestions();
      const domains = getCustomDomains();
      domains.forEach(d => addDomainOption(d));
      updateKeywordUI();
      const input = document.getElementById('keywordInput');
      if (input) {
        input.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ',') {
            e.preventDefault();
            addKeyword(input.value);
            input.value = '';
          }
        });
      }
      const btn = document.getElementById('processBtn');
      if (btn) {
        btn.addEventListener('click', () => {
          clearRestResults();
          const opts = document.getElementById('processOptions');
          if (opts) {
            opts.style.display = opts.style.display === 'none' ? 'block' : 'none';
          }
          btn.style.backgroundColor = '#003366';
          btn.textContent = 'Processed';
        });
      }

      const domainSelect = document.getElementById('emailFilter');
      if (domainSelect) {
        domainSelect.addEventListener('change', () => {
          clearRestResults();
          resetProcessButton();
          updateCounts();
        });
      }

      const addSuggestion = document.getElementById('addSuggestion');
      if (addSuggestion) {
        addSuggestion.addEventListener('click', () => {
          const kw = prompt('Enter new keyword');
          if (kw) {
            saveSuggestion(kw.trim());
          }
        });
      }

      updateCounts();
    });

  function updateFileList() {
    fileListDisplay.innerHTML = allFiles.map((f, i) => `
      <div class="file-item">
        <span>${f.name}</span>
        <button onclick="removeFile(${i})"><img src="https://img.icons8.com/?size=100&id=67884&format=png&color=000000" alt="delete"></button>
      </div>`).join('');
    generateFileSuggestions();
    updateCounts();
  }

  function clearRestResults() {
    const container = document.getElementById('restContainer');
    const list = document.getElementById('restList');
    if (list) list.innerHTML = '';
    if (container) container.style.display = 'none';
  }

  function resetProcessButton() {
    const btn = document.getElementById('processBtn');
    if (btn) {
      btn.style.backgroundColor = '#28a745';
      btn.textContent = 'Process';
    }
  }

  function resetUI() {
    selectedKeywords = [];
    updateKeywordUI();
    clearRestResults();
    resetProcessButton();
    const opts = document.getElementById('processOptions');
    if (opts) opts.style.display = 'none';
    updateCounts();
  }

  function removeFile(index) {
    allFiles.splice(index, 1);
    updateFileList();
    fileInput.value = '';
    clearRestResults();
    resetProcessButton();
    updateCounts();
  }

    dropArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropArea.style.borderColor = '#003366';
    });

    dropArea.addEventListener('dragleave', () => {
      dropArea.style.borderColor = '#ccc';
    });

    dropArea.addEventListener('drop', (e) => {
      e.preventDefault();
      dropArea.style.borderColor = '#ccc';
      allFiles = Array.from(e.dataTransfer.files);
      resetUI();
      updateFileList();
      updateCounts();
    });

    dropArea.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', () => {
      allFiles = Array.from(fileInput.files);
      fileInput.value = '';
      resetUI();
      updateFileList();
      updateCounts();
    });

    function extractForKeyword(keyword, label, domain, cb) {
      let output = '';
      let entryCount = 0;
      let filesRead = 0;
      allFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const lines = e.target.result.split(/\r?\n/);
          let block = [];
          for (let line of lines) {
            if (line.trim() === '') {
              const text = block.join('\n');
              const kwMatch = keyword ? text.toLowerCase().includes(keyword) : true;
              if (kwMatch && matchesDomain(text, domain)) {
                output += text + '\n\n';
                entryCount++;
              }
              block = [];
            } else {
              block.push(line);
            }
          }
          if (block.length) {
            const text = block.join('\n');
            const kwMatch = keyword ? text.toLowerCase().includes(keyword) : true;
            if (kwMatch && matchesDomain(text, domain)) {
              output += text + '\n\n';
              entryCount++;
            }
          }
          filesRead++;
          if (filesRead === allFiles.length) {
            const mainFileName = allFiles[0].name.split('.')[0].split(/[- ]/)[0];
            const cleaned = label.replace(/\s+/g, ' ').trim();
            let fileName;
            if (!label && !domain) {
              fileName = `${mainFileName} - combined (${entryCount} Entries).txt`;
            } else if (label) {
              fileName = `${mainFileName} - ${cleaned} (${entryCount} Entries).txt`;
            } else {
              fileName = `${mainFileName} - ${domain} (${entryCount} Entries).txt`;
            }
            cb({output, entryCount, fileName});
          }
        };
        reader.readAsText(file);
      });
    }
    function downloadBlob(text, name) {
      const blob = new Blob([text], {type: "text/plain"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = name;
      link.click();
    }


    async function extractEntries() {
      const keywords = getKeywords();
      const domain = document.getElementById('emailFilter').value;
      if (!allFiles.length) {
        alert("Please select file(s).");
        return;
      }
      keywords.forEach(k => saveSuggestion(k));
      if (!keywords.length && !domain) {
        await new Promise(res => {
          extractForKeyword('', 'combined', '', ({output, fileName}) => {
            if (output) {
              const blob = new Blob([output], {type: 'text/plain'});
              const link = document.createElement('a');
              link.href = URL.createObjectURL(blob);
              link.download = fileName;
              link.click();
            }
            res();
          });
        });
        return;
      }
      const list = keywords.length ? keywords : [''];
      for (const k of list) {
        await new Promise(res => {
          extractForKeyword(k.toLowerCase(), k, domain, ({output, fileName}) => {
            if (output) {
              const blob = new Blob([output], {type: 'text/plain'});
              const link = document.createElement('a');
              link.href = URL.createObjectURL(blob);
              link.download = fileName;
              link.click();
            } else {
              alert('No matches found.');
            }
            res();
          });
        });
      }
    }
    function downloadRest() {
      const keywords = getKeywords().map(k => k.toLowerCase());
      const domain = document.getElementById('emailFilter').value;
      if (!allFiles.length) {
        alert("Please select file(s).");
        return;
      }
      keywords.forEach(k => saveSuggestion(k));
      const restInfos = [];
      let combinedOutput = '';
      let combinedCount = 0;
      let processed = 0;
      allFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const lines = e.target.result.split(/\r?\n/);
          let block = [];
          let output = '';
          let count = 0;
          for (let line of lines) {
            if (line.trim() === '') {
              const text = block.join('\n');
              const kwMatch = keywords.length ? keywords.some(k => text.toLowerCase().includes(k)) : false;
              const dMatch = matchesDomain(text, domain);
              if (!keywords.length && !domain) {
                output += text + '\n\n';
                count++;
              } else if ((keywords.length && !kwMatch && dMatch) || (!keywords.length && domain && !dMatch)) {
                output += text + '\n\n';
                count++;
              }
              block = [];
            } else {
              block.push(line);
            }
          }
          if (block.length) {
            const text = block.join('\n');
            const kwMatch = keywords.length ? keywords.some(k => text.toLowerCase().includes(k)) : false;
            const dMatch = matchesDomain(text, domain);
            if (!keywords.length && !domain) {
              output += text + '\n\n';
              count++;
            } else if ((keywords.length && !kwMatch && dMatch) || (!keywords.length && domain && !dMatch)) {
              output += text + '\n\n';
              count++;
            }
          }
          restInfos.push({file, output, count});
          combinedOutput += output;
          combinedCount += count;
          processed++;
          if (processed === allFiles.length) {
            showRestResults(restInfos, combinedOutput, combinedCount, keywords, domain);
          }
        };
        reader.readAsText(file);
      });
    }

    function showRestResults(list, combinedOutput, combinedCount, keywords, domain) {
      const container = document.getElementById('restContainer');
      const listDiv = document.getElementById('restList');
      listDiv.innerHTML = '';
      const files = [];
        list.forEach(info => {
          if (!info.output) return;
          const baseName = info.file.name
            .replace(/\.[^.]+$/, '')
            .replace(/\s*\(\d+[^)]*Entries?\)/i, '')
            .trim();
          const name = `${baseName} (${info.count} Entries).txt`;
        files.push({name, text: info.output});
        const item = document.createElement('div');
        item.className = 'rest-item';
        const span = document.createElement('span');
        span.textContent = name;
        const btn = document.createElement('button');
        btn.innerHTML = '<img src="https://cdn-icons-png.flaticon.com/512/9502/9502265.png" class="btn-icon" alt="download">Download';
        btn.addEventListener('click', () => downloadBlob(info.output, name));
        item.appendChild(span);
        item.appendChild(btn);
        listDiv.appendChild(item);
      });
        const mainBase = allFiles[0].name
          .replace(/\.[^.]+$/, '')
          .replace(/\s*\(\d+[^)]*Entries?\)/i, '')
          .trim();
        const combinedName = `${mainBase} (${combinedCount} Entries).txt`;
      const btnAllCombined = document.getElementById('restCombinedBtn');
      btnAllCombined.onclick = () => downloadBlob(combinedOutput, combinedName);
      const btnAllFiles = document.getElementById('restAllBtn');
      btnAllFiles.onclick = () => files.forEach(f => downloadBlob(f.text, f.name));
      container.style.display = 'block';
    }
  </script>
</body>
</html>
